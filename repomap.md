# RepoMap - repomap

**Generated by Repomap**

## Folder Information

- **Name**: repomap
- **Path**: `C:/workspace/environment/repomap`
- **File Count**: 9 files
- **Size**: 0.12 MB
- **Generated**: 2025-07-03 23:12:39
- **AI Analysis**: Complete (3 files analyzed)

## Filetree

```
├── src/
│   ├── config.py [244 lines]
│   └── hello.py [1214 lines]
├── .gitignore [13 lines]
├── .python-version [1 lines]
├── pyproject.toml [12 lines]
├── README.md [13 lines]
├── requirements.txt [1 lines]
├── run.py [23 lines]
└── uv.lock [760 lines]
```

## AI Analysis Results

*Generated using Gemini API*

### run.py

---

### src\config.py

**Module Constants:**
- `DEFAULT_GITIGNORE_PATTERNS` = ['repomap.md', 'node_modules/', 'venv/', ...] - A comprehensive list of file and directory patterns used as a default .gitignore configuration. This is applied when no .gitignore file is found in the target repository to exclude common build artifacts, dependencies, IDE files, and other non-source files from analysis.
- `AI_MODEL_NAME` = gemini-2.5-pro - Specifies the identifier for the AI model to be used for code analysis tasks.
- `AI_MAX_WORKERS` = 5 - Sets the maximum number of concurrent workers (threads or processes) for performing AI analysis, controlling the level of parallelism.
- `SUPPORTED_CODE_EXTENSIONS` = {'.py', '.js', '.ts', '.jsx', '.tsx', ...} - A set containing file extensions that are considered to be source code. Only files with these extensions will be processed for analysis.
- `AI_PROMPT_TEMPLATE` = """
Analyze this code file and return ONLY a valid JSON object with the following structure:
...
""" - A multi-line string template for the prompt sent to the AI model. It defines the analysis task, the required JSON output structure, and the rules for the AI's response. It includes placeholders for the file name and content.

---

### src\hello.py

**Classes:**
- **`FileChangeHandler`** - Handles file system events (modify, create, delete) for a specific folder to trigger re-analysis automatically. It uses debouncing to avoid excessive updates.
  - `__init__(self, app: 'RepomapApp', folder_path: str)` - Initializes the file change handler with a reference to the main application and the folder path to watch.
  - `set_folder_index(self, index: int) -> None` - Sets the index of the folder this handler is watching, used to update the correct data in the main app.
  - `on_modified(self, event) -> None` - Handles file modification events. It adds the changed file to a pending set and schedules a debounced analysis.
  - `on_created(self, event) -> None` - Handles file creation events. If it's a code file, it schedules a debounced analysis. It always triggers a full metadata and filetree update.
  - `on_deleted(self, event) -> None` - Handles file deletion events. It removes the file's analysis data from the application's state and triggers a full metadata and filetree update.
  - `trigger_full_update(self) -> None` - Schedules a debounced update of the folder's metadata and filetree, canceling any previously pending updates.
  - `perform_full_update(self) -> None` - Performs the actual folder update (metadata, filetree, RepoMap.md) after the debounce timer expires. This does not re-run AI analysis.
  - `analyze_pending_files(self) -> None` - Triggers AI analysis for all files that have changed, merges the new analysis with existing data, and updates the application state and UI.
  - `app` (RepomapApp) - A reference to the main application instance.
  - `folder_path` (str) - The absolute path to the folder being watched.
  - `pending_files` (set) - A set of file paths that have changed and are awaiting debounced analysis.
  - `debounce_timer` (str | None) - The timer ID for the tkinter `after` method, used for debouncing events.

- **`RepomapApp`** - The main application class for the Repomap GUI, built with tkinter. It manages tracked folders, handles user interactions, orchestrates AI analysis, and displays the results.
  - `__init__(self)` - Initializes the application, sets up the main window, loads saved data, and builds the UI.
  - `create_toolbar(self) -> None` - Creates the top toolbar UI element containing the 'Add Folder' button and AI status indicator.
  - `select_folder(self) -> None` - Opens a system file dialog to allow the user to select a folder to track.
  - `add_folder(self, folder_path: str) -> None` - Adds a new folder to be tracked, performs initial metadata gathering, starts file watching, and initiates background AI analysis.
  - `run_ai_analysis_async(self, folder_path: str, folder_index: int) -> None` - Runs the full AI analysis for a folder in a separate background thread to keep the UI responsive.
  - `load_gitignore_patterns(self, folder_path: str) -> list` - Loads and parses .gitignore patterns from the specified folder and its parent directories.
  - `create_default_gitignore(self, folder_path: str) -> None` - Creates a default .gitignore file in the folder if one does not exist, populated with relevant patterns.
  - `add_repomap_to_gitignore(self, gitignore_path: str, existing_content: str) -> None` - Appends 'repomap.md' to an existing .gitignore file to prevent it from being committed to version control.
  - `pattern_matches_existing(self, pattern: str, all_items: set) -> bool` - Checks if a given gitignore pattern matches any of the existing files or directories in the project.
  - `create_repomap_md(self, folder_path: str, folder_info: dict) -> None` - Generates or updates the `repomap.md` file in a folder, containing its information, filetree, and AI analysis results.
  - `get_current_timestamp(self) -> str` - Returns the current system time as a formatted string.
  - `count_file_lines(self, file_path: str) -> int` - Counts and returns the number of lines in a given text file.
  - `generate_filetree(self, folder_path: str) -> list` - Generates a list of strings representing the hierarchical filetree of a folder, excluding ignored files and including line counts.
  - `save_folders(self) -> None` - Saves the current list of tracked folders and their state to a persistent JSON file.
  - `load_saved_folders(self) -> None` - Loads the list of tracked folders from the persistent JSON file on application startup.
  - `is_ignored(self, file_path: str, folder_path: str, gitignore_patterns: list) -> bool` - Checks if a file path should be ignored based on the loaded gitignore patterns.
  - `_walk_repository_files(self, folder_path: str) -> Generator[str, None, None]` - A generator that yields all non-ignored file paths in a folder, respecting .gitignore rules.
  - `count_files(self, folder_path: str) -> int` - Counts the total number of non-ignored files within a given folder path.
  - `should_ignore_implicitly(self, path: str) -> bool` - Checks if a path should be implicitly ignored (e.g., '.git', '__pycache__').
  - `get_folder_size(self, folder_path: str) -> str` - Calculates the total size of all non-ignored files in a folder and returns it as a formatted string (e.g., '12.34 MB').
  - `show_empty_state(self) -> None` - Displays a welcome message and an 'Add Folder' button in the UI when no folders are currently being tracked.
  - `update_display(self) -> None` - Refreshes the main UI by clearing and redrawing the list of folder cards based on the current application state.
  - `create_folder_card(self, parent: tk.Widget, folder: dict, index: int) -> None` - Creates a single UI card widget for a tracked folder, displaying its name, path, stats, and a remove button.
  - `_show_confirmation_dialog(self, title: str, message: str, delete_repomap_option: bool, confirm_callback: callable) -> None` - Displays a generic modal confirmation dialog to the user.
  - `remove_folder(self, index: int) -> None` - Handles the logic for removing a tracked folder, including showing a confirmation dialog and cleaning up associated resources.
  - `setup_ai_analysis(self) -> None` - Initializes the AI analysis component by checking for environment variable API keys and configuring the generative AI library.
  - `setup_file_watching(self) -> None` - Initializes the watchdog file system observers for all folders loaded at startup.
  - `start_watching_folder(self, folder_path: str, folder_index: int) -> None` - Starts a new watchdog file system observer for a specific folder.
  - `stop_watching_folder(self, folder_path: str) -> None` - Stops and cleans up the watchdog observer for a specific folder.
  - `update_folder_watcher_index(self, folder_path: str, new_index: int) -> None` - Updates the folder index stored in a FileChangeHandler, necessary when folders are removed.
  - `refresh_folder_metadata(self, folder_index: int) -> None` - Manually triggers a refresh of a folder's metadata (file count, size, etc.) and updates the display.
  - `analyze_file_with_ai(self, file_path: str, folder_path: str, gitignore_patterns: list) -> dict | None` - Analyzes the content of a single file using the configured generative AI API to extract its structure (classes, functions, etc.).
  - `parse_fallback_analysis(self, response_text: str, file_path: str, folder_path: str) -> dict` - Provides a simple fallback text-based parser for the AI response in case the primary JSON parsing fails.
  - `analyze_folder_with_ai(self, folder_path: str) -> list` - Orchestrates the AI analysis of all supported code files in a folder using a thread pool for concurrency.
  - `is_code_file(self, file_path: str) -> bool` - Checks if a file's extension is in the list of supported code file types for AI analysis.
  - `run(self) -> None` - Starts the tkinter main event loop to run the application and handles cleanup on exit.
  - `cleanup_file_watchers(self) -> None` - Stops all active watchdog file system observers when the application is closing.
  - `root` (tk.Tk) - The root tkinter window for the application.
  - `storage_file` (str) - The path to the JSON file used for persistent storage of folder data.
  - `folders` (list[dict]) - A list of dictionaries, where each dictionary stores metadata and analysis results for a tracked folder.
  - `file_watchers` (dict) - A dictionary mapping folder paths to their active `watchdog` observer and handler instances.
  - `ai_enabled` (bool) - A flag indicating whether AI analysis is configured and available (i.e., an API key was found).


**Standalone Functions:**
- `main() -> None` - The main entry point of the script. It creates an instance of RepomapApp and runs it.

**Module Variables:**
- `AI_AVAILABLE` (bool) - A boolean flag indicating if the 'google.generativeai' dependency was successfully imported.
- `WATCHDOG_AVAILABLE` (bool) - A boolean flag indicating if the 'watchdog' dependency was successfully imported.

---

