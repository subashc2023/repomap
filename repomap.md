# RepoMap - repomap

**Generated by Repomap**

## Folder Information

- **Name**: repomap
- **Path**: `C:/workspace/environment/repomap`
- **File Count**: 9 files
- **Size**: 0.13 MB
- **Generated**: 2025-07-03 22:51:20
- **AI Analysis**: Complete (3 files analyzed)

## Filetree

├── src/
│   ├── config.py [244 lines]
│   └── hello.py [1302 lines]
├── .gitignore [12 lines]
├── .python-version [1 lines]
├── pyproject.toml [12 lines]
├── README.md [6 lines]
├── requirements.txt [1 lines]
├── run.py [23 lines]
└── uv.lock [760 lines]

## AI Analysis Results

*Generated using Gemini API*

### run.py

---

### src\config.py

**Module Constants:**
- `DEFAULT_GITIGNORE_PATTERNS` = ['RepoMap.md', 'node_modules/', 'venv/', ...] - A comprehensive list of default file and directory patterns to ignore, used when a project's .gitignore file is not found. It covers dependencies, build outputs, IDE files, logs, and more.
- `AI_MODEL_NAME` = gemini-2.5-pro - Specifies the identifier for the AI model to be used for code analysis.
- `AI_MAX_WORKERS` = 5 - Defines the maximum number of concurrent workers or threads for processing AI analysis tasks.
- `SUPPORTED_CODE_EXTENSIONS` = {'.py', '.js', '.ts', '.jsx', '.tsx', ...} - A set of file extensions that are recognized as source code and are eligible for analysis.
- `AI_PROMPT_TEMPLATE` = "Analyze this code file and return ONLY a valid JSON object..." - The string template used to generate the prompt sent to the AI model. It includes instructions, the required JSON output structure, and placeholders for the file name and content.

---

### src\hello.py

**Classes:**
- **`FileChangeHandler`** - Handles file system events (modify, create, delete) for a specific folder using the watchdog library. It debounces events to prevent rapid, successive updates and triggers re-analysis or metadata updates in the main application.
  - `__init__(self, app, folder_path)` - Initializes the handler with a reference to the main application and the path of the folder to watch.
  - `set_folder_index(self, index)` - Sets the index of the folder this handler is watching, used to update the correct data in the main app.
  - `on_modified(self, event)` - Callback for file modification events. It adds the changed file to a pending queue and schedules a debounced re-analysis.
  - `on_created(self, event)` - Callback for file creation events. It triggers a debounced analysis for new code files and a full metadata update.
  - `on_deleted(self, event)` - Callback for file deletion events. It removes the AI analysis data for the deleted file and triggers a full metadata update.
  - `trigger_full_update(self)` - Schedules a debounced, full update of the folder's metadata and filetree display, canceling any previously pending updates.
  - `perform_full_update(self)` - Performs a full update of folder metadata (file count, size, filetree) and regenerates the RepoMap.md file, without re-running AI analysis on all files.
  - `analyze_pending_files(self)` - Initiates AI analysis for all files that have been recently created or modified and are in the pending queue.
  - `app` (RepomapApp) - A reference to the main application instance.
  - `folder_path` (str) - The absolute path of the folder being watched.
  - `folder_index` (int) - The index of the watched folder within the application's main folder list.
  - `pending_files` (set) - A set of file paths that have been modified and are awaiting analysis.
  - `debounce_timer` (object) - The timer object used for debouncing file system events.

- **`RepomapApp`** - The main application class that manages the Tkinter GUI, folder data, AI-powered code analysis, and file system watching. It provides the user interface for adding, viewing, and removing tracked code repositories.
  - `__init__(self)` - Initializes the main application window, loads saved folder data, sets up AI and file watching capabilities, and creates the initial UI.
  - `create_toolbar(self)` - Creates the main toolbar UI element, including buttons for adding folders, deleting selected folders, and an AI status indicator.
  - `select_folder(self)` - Opens a system dialog to allow the user to select a folder to add to the application.
  - `add_folder(self, folder_path: str)` - Adds a folder to the application, gathers initial metadata, starts a file watcher, and triggers a background AI analysis.
  - `run_ai_analysis_async(self, folder_path: str, folder_index: int)` - Runs the AI analysis for an entire folder in a background thread to keep the UI responsive.
  - `load_gitignore_patterns(self, folder_path: str) -> list` - Loads and parses .gitignore patterns from the specified folder and its parent directories.
  - `create_default_gitignore(self, folder_path: str)` - Creates a default .gitignore file in a folder if one does not exist, populated with common ignore patterns.
  - `add_repomap_to_gitignore(self, gitignore_path: str, existing_content: str)` - Appends 'RepoMap.md' to an existing .gitignore file to prevent it from being committed to version control.
  - `pattern_matches_existing(self, pattern: str, all_items: set) -> bool` - Checks if a given gitignore pattern matches any of the existing file or directory paths in a set.
  - `create_repomap_md(self, folder_path: str, folder_info: dict)` - Generates or updates the `RepoMap.md` file in a project's root with its metadata, filetree, and AI analysis results.
  - `get_current_timestamp(self) -> str` - Returns the current date and time as a formatted string.
  - `count_file_lines(self, file_path: str) -> int` - Counts the number of lines in a text file.
  - `generate_filetree(self, folder_path: str) -> list` - Generates a hierarchical list of strings representing the folder's filetree, respecting .gitignore rules and showing line counts for files.
  - `save_folders(self)` - Saves the list of tracked folders and their metadata to a persistent JSON file.
  - `load_saved_folders(self)` - Loads the list of tracked folders from the persistent JSON file on application startup.
  - `is_ignored(self, file_path: str, folder_path: str, gitignore_patterns: list) -> bool` - Checks if a file or directory should be ignored based on the collected .gitignore patterns.
  - `_walk_repository_files(self, folder_path: str) -> generator` - A generator that yields all non-ignored files in a folder, respecting .gitignore and implicit ignore rules.
  - `count_files(self, folder_path: str) -> int` - Counts the total number of non-ignored files in a folder.
  - `should_ignore_implicitly(self, path: str) -> bool` - Checks if a path should be implicitly ignored (e.g., '.git', '__pycache__').
  - `get_folder_size(self, folder_path: str) -> str` - Calculates the total size of all non-ignored files in a folder and returns it as a human-readable string (MB or GB).
  - `show_empty_state(self)` - Displays a welcome message and an 'Add a folder' button when no folders are being tracked.
  - `update_display(self)` - Refreshes the main UI to reflect the current state of tracked folders, creating a card for each one.
  - `create_folder_card(self, parent: tk.Widget, folder: dict, index: int)` - Creates a single UI widget (a 'card') to display information about a tracked folder.
  - `_show_confirmation_dialog(self, title: str, message: str, delete_repomap_option: bool, confirm_callback: callable)` - Displays a generic modal confirmation dialog to the user.
  - `remove_folder(self, index: int)` - Removes a single folder from the application after user confirmation.
  - `toggle_folder_selection(self, index: int)` - Toggles the selection state of a folder card in the UI.
  - `delete_selected_folders(self)` - Removes all currently selected folders from the application after user confirmation.
  - `update_trash_button(self)` - Enables or disables the trash button in the toolbar based on whether any folders are selected.
  - `setup_ai_analysis(self)` - Checks for Gemini/Google API keys in environment variables and configures the AI service if available.
  - `setup_file_watching(self)` - Initializes and starts watchdog file system observers for all loaded folders.
  - `start_watching_folder(self, folder_path: str, folder_index: int)` - Starts a new watchdog observer for a specific folder.
  - `stop_watching_folder(self, folder_path: str)` - Stops and cleans up the watchdog observer for a specific folder.
  - `update_folder_watcher_index(self, folder_path: str, new_index: int)` - Updates the folder index in a FileChangeHandler after other folders have been removed.
  - `refresh_folder_metadata(self, folder_index: int)` - Manually triggers a refresh of a folder's metadata (file count, size) and updates the UI.
  - `analyze_file_with_ai(self, file_path: str, folder_path: str, gitignore_patterns: list) -> dict` - Sends the content of a single file to the AI API for analysis and parses the structured JSON response.
  - `parse_fallback_analysis(self, response_text: str, file_path: str, folder_path: str) -> dict` - Provides a best-effort fallback parsing mechanism if the AI response is not valid JSON.
  - `analyze_folder_with_ai(self, folder_path: str) -> list` - Analyzes all valid code files in a folder concurrently using a thread pool to make parallel API requests.
  - `is_code_file(self, file_path: str) -> bool` - Checks if a file's extension is in the list of supported code file types for AI analysis.
  - `run(self)` - Starts the Tkinter main event loop and ensures file watchers are cleaned up on exit.
  - `cleanup_file_watchers(self)` - Stops all active file system watchers.
  - `root` (tk.Tk) - The main Tkinter window instance.
  - `storage_file` (str) - Path to the JSON file used for persisting the list of tracked folders.
  - `folders` (list[dict]) - A list of dictionaries, where each dictionary stores the metadata for a tracked folder.
  - `selected_folders` (set[int]) - A set of indices corresponding to the folders currently selected in the UI.
  - `ai_enabled` (bool) - Flag indicating whether AI analysis is available and configured with an API key.
  - `file_watchers` (dict) - A dictionary mapping folder paths to their corresponding watchdog observer and handler instances.


**Standalone Functions:**
- `main()` - The main entry point for the application. It instantiates the RepomapApp and starts its execution.

**Module Variables:**
- `AI_AVAILABLE` (bool) - A boolean flag that is True if the 'google.generativeai' library was successfully imported, False otherwise.
- `WATCHDOG_AVAILABLE` (bool) - A boolean flag that is True if the 'watchdog' library was successfully imported, False otherwise.

---

